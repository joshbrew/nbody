(()=>{var A=[{name:"Sun",mass:1989e27,distance:0,velocity:0,color:"yellow"},{name:"Mercury",mass:33011e19,distance:.387,velocity:47870,color:"orange"},{name:"Venus",mass:48675e20,distance:.723,velocity:35020,color:"yellow"},{name:"Earth",mass:597237e19,distance:1,velocity:29780,color:"blue"},{name:"Earth's Moon",mass:7342e19,distance:1.00257,velocity:30802,color:"gray"},{name:"Mars",mass:64171e19,distance:1.524,velocity:24070,color:"red"}],k=[{name:"Jupiter",mass:1898e24,distance:5.2,velocity:13070,color:"brown"},{name:"Io",mass:89319e18,distance:5.2+.002821,velocity:13070+17334,color:"yellow"},{name:"Europa",mass:47998e18,distance:5.2+.004486,velocity:13070+13740,color:"white"},{name:"Ganymede",mass:14819e19,distance:5.2+.007155,velocity:13070+10880,color:"gray"},{name:"Callisto",mass:10759e19,distance:5.2+.012585,velocity:13070+8204,color:"darkgray"},{name:"Saturn",mass:5683e23,distance:9.5,velocity:9680,color:"goldenrod"},{name:"Titan",mass:13452e19,distance:9.5+.008168,velocity:9680+5570,color:"orange"},{name:"Uranus",mass:8681e22,distance:19.8,velocity:6810,color:"lightblue"},{name:"Neptune",mass:1024e23,distance:30.1,velocity:5430,color:"blue"},{name:"Pluto",mass:1309e19,distance:39.48,velocity:4740,color:"coral"}];var $=66743e-15,Y=3600,C=1496e8,u={mass:48e4,x:0,y:0,vx:0,vy:0,fx:0,fy:0,color:"red"},F=3e4,p=!1;document.body.insertAdjacentHTML("afterbegin",`
    <div>
      Rocket simulation with tweaked physics and log-scaling for fun-factor.<br/>
      Rocket Mass (kg): <input type='number' id='mass' value='${u.mass}'/><br/>
      Rocket Initial Force (multiplies over initial time step): <input type='number' id='force' value='${F}'/><br/>
      Time step (s): <input type='number' id='timeStep' value='${Y}'/>
    </div>
    <canvas style="width:100%;" id="solarSystem" width="800" height="800"></canvas>
    
`);var i=document.getElementById("solarSystem"),g=i.getContext("2d");document.getElementById("mass").onchange=t=>{u.mass=parseFloat(t.target.value)};document.getElementById("force").onchange=t=>{F=parseFloat(t.target.value)};document.getElementById("timeStep").onchange=t=>{Y=parseFloat(t.target.value)};var j=[...A,...k],X=H(j),b=X.reduce((t,e)=>t.mass>e.mass?t:e),M,q,P=100,E=Math.max(...j.map(t=>Math.abs(t.distance))),R=E*C,D,L,z=300*Y;i.addEventListener("mousemove",t=>{let e=i.getBoundingClientRect();D=t.clientX-e.left-i.width/2,L=t.clientY-e.top-i.height/2});function H(t){return t.map(e=>({name:e.name,mass:e.mass,x:e.x?e.x:e.distance*C,y:e.y?e.y:e.distanceY?e.distanceY:0,vx:e.velocityX?e.velocityX:0,vy:e.velocity?e.velocity:e.velocityY?e.velocityY:0,color:e.color}))}function B(t,e=M){let n=.55;return t<R?t>1?Math.pow(t*q*e,n+E*.0025*(1-t/R)):0:Math.pow(R*q*e,n)+(t/R-1)}function J(t,e,n,a,r,c,l){let o=Math.atan2(n,e),m=Math.sqrt(e*e+n*n),x=B(m),h=r/2+Math.cos(o)*M*x,s=c/2+Math.sin(o)*M*x,d=Math.log10(a)*.1,y=Math.pow(d,d)*.4;t.beginPath(),t.arc(h,s,y,0,Math.PI*2),t.fillStyle=l||"gray",t.fill()}function N(t=X,e=u,n=Y){if(!M){let a=Math.log10(E*C+1);console.log(a),M=Math.min(i.width,i.height)/(2*a),q=1/(R*.5),P=E>M?M*3.33:E*10}if(g.clearRect(0,0,i.width,i.height),t.forEach(a=>{let r=a.x,c=a.y;if(a!==b&&a.mostInfluentialBody&&a.mostInfluentialBody!==b){let l=a.x-a.mostInfluentialBody.x,o=a.y-a.mostInfluentialBody.y;r=a.mostInfluentialBody.x+l*P,c=a.mostInfluentialBody.y+o*P,a.exaggeratedX=r,a.exaggeratedY=c}if(J(g,r,c,a.mass,i.width,i.height,a.color),D&&L&&a.name==="Earth"){let l=Math.atan2(L,D),o={x:a.x+Math.cos(l)*a.x*.2*Math.sign(a.x),y:a.y+Math.sin(l)*a.y*.2*Math.sign(a.y),vx:a.vx,vy:a.vy,mass:e.mass},m=F*n*n/o.mass;o.vx+=Math.cos(l)*m,o.vy+=Math.sin(l)*m;let x=Math.sqrt(o.x**2+o.y**2),h=B(x),s=Math.atan2(o.y,o.x),d=i.width/2+Math.cos(s)*h*M,y=i.height/2+Math.sin(s)*h*M;g.beginPath(),g.moveTo(d,y);let v=structuredClone(t);for(let f=0;f<z;f+=n){G(v,o,n);let w=Math.sqrt(o.x**2+o.y**2),S=B(w),I=Math.atan2(o.y,o.x),T=i.width/2+Math.cos(I)*S*M,V=i.height/2+Math.sin(I)*S*M;g.lineTo(T,V)}g.strokeStyle="yellow",g.lineWidth=1,g.stroke()}}),p){let a=Math.sqrt(e.x**2+e.y**2),r=B(a),c=Math.atan2(e.y,e.x),l=i.width/2+Math.cos(c)*r*M,o=i.height/2+Math.sin(c)*r*M,m=Math.atan2(e.vy,e.vx),x=7,h=l+x*Math.cos(m),s=o+x*Math.sin(m),d=l-x*(Math.cos(m)-.5*Math.sin(m)),y=o-x*(Math.sin(m)+.5*Math.cos(m)),v=l-x*(Math.cos(m)+.5*Math.sin(m)),f=o-x*(Math.sin(m)-.5*Math.cos(m));g.beginPath(),g.moveTo(h,s),g.lineTo(d,y),g.lineTo(v,f),g.closePath(),g.fillStyle=u.color,g.fill()}}function G(t=X,e=u,n=Y,a=b){let r=0,c=0,l=0,o;e&&(e.fx=0,e.fy=0,o=Math.log(Math.log(a.mass)));for(let h=0;h<t.length;h++){let s=t[h];s.maxForce=0;for(let d=0;d<t.length;d++){if(h===d)continue;let y=t[d],v=s.x-y.x,f=s.y-y.y,w=Math.sqrt(v*v+f*f);if(w===0)throw new Error("Collision detected between "+s.name+" and "+y.name);let S=$*y.mass/(w*w);(S>s.maxForce||y!==a&&S>s.maxForce*.25)&&(s.maxForce=S,s.mostInfluentialBody=y);let I=S*v/w,T=S*f/w;s.vx-=I*n,s.vy-=T*n}if(r+=s.mass,c+=s.x*s.mass,l+=s.y*s.mass,e){let d=e.x-(s.exaggeratedX?s.exaggeratedX:s.x),y=e.y-(s.exaggeratedY?s.exaggeratedY:s.y),v=Math.sqrt(d*d+y*y);if(v===0)continue;let f=$*s.mass/Math.pow(v,1.98-(s.mass<a.mass?3*(o-Math.log(Math.log(s.mass))):0)),w=f*d/v,S=f*y/v;e.vx-=w*n,e.vy-=S*n,e===u&&v<.02*C&&(console.log("Rocket hit",s.name),p=!1)}}t.forEach(h=>{h.x+=h.vx*n,h.y+=h.vy*n});let m=c/r,x=l/r;return e&&(e.x+=e.vx*n,e.y+=e.vy*n),{x:m,y:x}}function U(){G(X,p?u:null,Y,b),N(),requestAnimationFrame(U)}U();function W(t){let e=i.getBoundingClientRect(),n=t.clientX-e.left-i.width/2,a=t.clientY-e.top-i.height/2,r=Math.atan2(a,n),c=X.find(o=>o.name==="Earth");c&&(u.x=c.x+Math.cos(r)*c.x*.2*Math.sign(c.x),u.y=c.y+Math.sin(r)*c.y*.2*Math.sign(c.y),u.vx=c.vx,u.vy=c.vy);let l=F*Y*Y/u.mass;u.vx+=Math.cos(r)*l,u.vy+=Math.sin(r)*l,p=!0,console.log("launched!")}i.addEventListener("click",W);})();
